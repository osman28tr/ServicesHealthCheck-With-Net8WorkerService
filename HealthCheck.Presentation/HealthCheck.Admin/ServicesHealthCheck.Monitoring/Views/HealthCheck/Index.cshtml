@{
    Layout = null;
}
@model List<GetListServiceHealthCheckResult>

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <title>Index</title>

    <script src="~/lib/microsoft/signalr/dist/browser/signalr.min.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script>
        $(document).ready(() => {
            var connection = new signalR.HubConnectionBuilder()
                .withUrl("http://localhost:5012/healthcheckhub")
                .build();

            connection.start();
            var messages = [];
            //servicename and status received
            connection.on("receiveMessage", (serviceName, status,cpuUsage,physicalMemoryUsage,virtualMemoryUsage,privateMemoryUsage,isHealthy) => {
                updateTable(serviceName, status, cpuUsage, physicalMemoryUsage, virtualMemoryUsage, privateMemoryUsage, isHealthy);
            }); // noktalı virgül eklenmeli

            function updateTable(serviceName, status, cpuUsage, physicalMemoryUsage, virtualMemoryUsage, privateMemoryUsage, isHealthy) {
                var existingRow = $('#table-body tr').filter(function () {
                    return $(this).find('td:nth-child(2)').text() === serviceName;
                });

                if (existingRow.length > 0) {
                    existingRow.find('td:nth-child(3)').text(status);
                    existingRow.find('td:nth-child(4)').text(cpuUsage);
                    existingRow.find('td:nth-child(5)').text(physicalMemoryUsage);
                    existingRow.find('td:nth-child(6)').text(virtualMemoryUsage);
                    existingRow.find('td:nth-child(7)').text(privateMemoryUsage);
                    existingRow.find('td:nth-child(8)').text(isHealthy);
                } else {
                    var row = `<tr>
                                        <td></td>
                                        <td>${serviceName}</td>
                                        <td>${status}</td>
                                                <td>${cpuUsage}</td>
                                                <td>${physicalMemoryUsage}</td>
                                                <td>${virtualMemoryUsage}</td>
                                                <td>${privateMemoryUsage}</td>
                                                <td>${isHealthy}</td>
                                   </tr>`;
                    $('#table-body').append(row);
                }
            }
        });
    </script>
</head>
<body>
    <div class="container-fluid" style="display:flex">
        <h3 style="margin-top:12px">Health Check Status</h3>
        <img src="~/icons/status.png" width="120px" height="60px" />
    </div>
    <br />
    @*  <ul id="messages">
    <li>servicename</li>
    </ul> *@

    <table class="table">
        <thead style="background-color:green; color:white">
        <tr>
            <th scope="col"></th>
            <th scope="col">Name</th>
            <th scope="col">Health</th>
            <th scope="col">CpuUsage</th>
            <th scope="col">PhysicalMemoryUsage</th>
            <th scope="col">VirtualMemoryUsage</th>
            <th scope="col">PrivateMemoryUsage</th>
            <th scope="col">IsHealthy</th>
@*             <th scope="col">Cpu Usage</th>
            <th scope="col">Physical Memory Usage</th>
            <th scope="col">Private Memory Usage</th>
            <th scope="col">Virtual Memory Usage</th> *@
            @*    <th scope="col">Description</th>
                <th scope="col">On state from</th>
                <th scope="col">Last execution</th> *@
        </tr>
        </thead>
        <tbody id="table-body">
        
        </tbody>
    </table>
</body>
</html>